<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A Manchester case study â€¢ bicischools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A Manchester case study">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bicischools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/fromOD2bikebus.html">From Origin-Destination Data to Bike Bus Routes</a></li>
    <li><a class="dropdown-item" href="../articles/manchester.html">A Manchester case study</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>A Manchester case study</h1>
            
      

      <div class="d-none name"><code>manchester.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">osmactive</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap" class="external-link">tmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">osmactive</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/stplanr" class="external-link">stplanr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://itsleeds.github.io/pct/" class="external-link">pct</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette demonstrates how to generate bike bus routes to Manley
Park Primary School in Manchester. We chose this school because an
existing bike bus was set up at the school in 2025. As a contrast from
the applications in Lisbon, Portugal, this shows that the bicischools
package can be used to support bike buses internationally.</p>
<p>First we define a catchment area for the school, based on local
knowledge of where students live.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## code to prepare `example_school_mcr` dataset goes here</span></span>
<span></span>
<span><span class="co"># Rough catchment for Manley Park Primary School</span></span>
<span><span class="va">zones</span> <span class="op">=</span> <span class="fu">zonebuilder</span><span class="fu">::</span><span class="fu">zb_zone</span><span class="op">(</span></span>
<span>  <span class="st">"Whalley Range Sure Start Centre"</span>,</span>
<span>  n_circles <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  distance <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">study_area</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="va">zones</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mapview</span><span class="fu">::</span><span class="fu">mapview</span><span class="op">(</span><span class="va">zones</span><span class="op">)</span></span></code></pre></div>
<p>We get speed limits for the local road network.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">osm_data</span> <span class="op">=</span> <span class="fu">osmactive</span><span class="fu">::</span><span class="fu">get_travel_network</span><span class="op">(</span></span>
<span>  place <span class="op">=</span> <span class="va">study_area</span>,</span>
<span>  boundary <span class="op">=</span> <span class="va">study_area</span>,</span>
<span>  boundary_type <span class="op">=</span> <span class="st">"clipsrc"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">osm_drive</span> <span class="op">=</span> <span class="fu">osmactive</span><span class="fu">::</span><span class="fu">get_driving_network</span><span class="op">(</span><span class="va">osm_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mapview</span><span class="fu">::</span><span class="fu">mapview</span><span class="op">(</span><span class="va">osm_drive</span>, zcol <span class="op">=</span> <span class="st">"maxspeed"</span><span class="op">)</span></span></code></pre></div>
<p>We can now estimate cycle Level of Service across the local road
network, based on speed limits and estimated traffic flows.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get Level of Service</span></span>
<span></span>
<span><span class="va">cycle_net</span> <span class="op">=</span> <span class="fu">osmactive</span><span class="fu">::</span><span class="fu">get_cycling_network</span><span class="op">(</span><span class="va">osm_data</span><span class="op">)</span></span>
<span><span class="va">cycle_net</span> <span class="op">=</span> <span class="fu">distance_to_road</span><span class="op">(</span><span class="va">cycle_net</span>, <span class="va">osm_drive</span><span class="op">)</span></span>
<span><span class="va">cycle_net</span> <span class="op">=</span> <span class="fu">classify_cycle_infrastructure</span><span class="op">(</span></span>
<span>  <span class="va">cycle_net</span>,</span>
<span>  include_mixed_traffic <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cycle_net</span> <span class="op">=</span> <span class="fu">estimate_traffic</span><span class="op">(</span><span class="va">cycle_net</span><span class="op">)</span></span>
<span><span class="va">cycle_net</span><span class="op">$</span><span class="va">AADT</span> <span class="op">=</span> <span class="fu">npt_to_cbd_aadt_numeric</span><span class="op">(</span><span class="va">cycle_net</span><span class="op">$</span><span class="va">assumed_volume</span><span class="op">)</span></span>
<span><span class="va">cycle_net</span> <span class="op">=</span> <span class="fu">level_of_service</span><span class="op">(</span><span class="va">cycle_net</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cycle_net</span><span class="op">[</span><span class="st">"Level of Service"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">mapview</span><span class="fu">::</span><span class="fu">mapview</span><span class="op">(</span><span class="va">cycle_net</span>, z <span class="op">=</span> <span class="st">"Level of Service"</span><span class="op">)</span></span></code></pre></div>
<p>After some data cleaning, student home locations are randomly chosen
within the defined school catchment.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cycle_net</span><span class="op">)</span></span>
<span><span class="va">cycle_net_cols_to_keep</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"osm_id"</span>,</span>
<span>  <span class="st">"name"</span>,</span>
<span>  <span class="st">"highway"</span>,</span>
<span>  <span class="st">"maxspeed"</span>,</span>
<span>  <span class="st">"bicycle"</span>,</span>
<span>  <span class="st">"cycleway_chars"</span>,</span>
<span>  <span class="st">"lanes"</span>,</span>
<span>  <span class="st">"segregated"</span>,</span>
<span>  <span class="st">"surface"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cycle_net</span> <span class="op">=</span> <span class="va">cycle_net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">cycle_net_cols_to_keep</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># usethis::use_data(example_school_mcr, overwrite = TRUE)</span></span>
<span></span>
<span><span class="co"># Create random home locations within the zonebuilder area</span></span>
<span><span class="va">cycle_net_joined</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="va">cycle_net</span><span class="op">)</span></span>
<span></span>
<span><span class="va">points</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html" class="external-link">st_sample</a></span><span class="op">(</span><span class="va">cycle_net_joined</span>, size <span class="op">=</span> <span class="fl">500</span>, <span class="op">)</span></span>
<span></span>
<span><span class="va">points</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">points</span><span class="op">)</span></span>
<span></span>
<span><span class="va">points</span> <span class="op">=</span> <span class="va">points</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_query.html" class="external-link">st_is_empty</a></span><span class="op">(</span><span class="va">points</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">points_single</span> <span class="op">=</span> <span class="va">points</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="st">"POINT"</span><span class="op">)</span></span>
<span><span class="va">points</span> <span class="op">=</span> <span class="va">points_single</span></span>
<span></span>
<span><span class="va">centre</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="va">zones</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">origins</span> <span class="op">&lt;-</span> <span class="va">points</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rowid_to_column</a></span><span class="op">(</span><span class="st">"id"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">cycle_net_joined</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">points</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_dots</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">centre</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_dots</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>We extract the number of students at the school from a national
schools dataset.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get number of students</span></span>
<span><span class="co"># school_manc = osmextract::oe_get("College Road, Whalley Range, Manchester, M16 0AA")</span></span>
<span><span class="co"># number of pupils = 430</span></span>
<span></span>
<span><span class="va">school_name</span> <span class="op">=</span> <span class="st">"Manley Park Primary School"</span></span>
<span><span class="fu">piggyback</span><span class="fu">::</span><span class="fu">pb_download</span><span class="op">(</span></span>
<span>  file <span class="op">=</span> <span class="st">"edubasealldata20250724.xlsx"</span>, </span>
<span>  tag <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  dest <span class="op">=</span> <span class="st">"./data-raw"</span><span class="op">)</span></span>
<span><span class="va">xlfile</span> <span class="op">=</span> <span class="st">"data-raw/edubasealldata20250724.xlsx"</span></span>
<span><span class="va">extract_students</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">school_name</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">=</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="va">xlfile</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">=</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">EstablishmentName</span> <span class="op">==</span> <span class="va">school_name</span><span class="op">)</span></span>
<span>  <span class="va">number_of_pupils</span> <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">NumberOfPupils</span></span>
<span><span class="op">}</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fu">extract_students</span><span class="op">(</span><span class="va">school_name</span><span class="op">)</span></span></code></pre></div>
<p>Desire lines represent trips from home to school.
<!-- These need fixing --></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create desire lines</span></span>
<span><span class="va">od</span> <span class="op">=</span> <span class="va">points</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>d <span class="op">=</span> <span class="va">centre</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></span>
<span></span>
<span><span class="va">od</span><span class="op">$</span><span class="va">geometry</span> <span class="op">=</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Map</a></span><span class="op">(</span><span class="va">st_union</span>, <span class="va">od</span><span class="op">$</span><span class="va">x</span>, <span class="va">od</span><span class="op">$</span><span class="va">d</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">od</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="st">"LINESTRING"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">od</span> <span class="op">=</span> <span class="va">od</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    desire_line_length <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/drop_units.html" class="external-link">drop_units</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_length</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">od</span> <span class="op">=</span> <span class="va">od</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">desire_line_length</span> <span class="op">&lt;</span> <span class="fl">5000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">od</span> <span class="op">=</span> <span class="va">od</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>trips <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">od</span><span class="op">)</span> <span class="op">/</span> <span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fix the geometry</span></span>
<span><span class="va">od_standard</span> <span class="op">=</span> <span class="va">od</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">trips</span>, <span class="va">desire_line_length</span>, <span class="va">geometry</span><span class="op">)</span></span>
<span><span class="va">od_standard</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">od_standard</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>destination <span class="op">=</span> <span class="st">"d"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>origin <span class="op">=</span> <span class="va">id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">origin</span>, <span class="va">destination</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The desire lines still look strange!</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">od_standard</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="st">"trips"</span>,col_alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p>We convert the desire lines into routes</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate routes to school from these points</span></span>
<span><span class="co"># Create routes</span></span>
<span></span>
<span><span class="va">routes_quiet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bici_routes.html">bici_routes</a></span><span class="op">(</span></span>
<span>  od.data <span class="op">=</span>   <span class="va">od_standard</span>,</span>
<span>  distance.threshold <span class="op">=</span> <span class="fl">5e3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">routes_quiet</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"./data-raw/routes-manchester.Rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Using the PCT Go Dutch scenario we estimate potential cycle uptake
under Dutch-style cycling levels.</p>
<p>We then convert the routes to school into a route network.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Rnet and PCT uptake</span></span>
<span></span>
<span><span class="va">routes_quiet_pct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/routes_pct_uptake.html">routes_pct_uptake</a></span><span class="op">(</span>routes <span class="op">=</span> <span class="va">routes_quiet</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rnet_quiet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/routes_network.html">routes_network</a></span><span class="op">(</span>routes <span class="op">=</span> <span class="va">routes_quiet_pct</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># tm_shape(rnet_quietest) +</span></span>
<span><span class="co">#   tm_lines(</span></span>
<span><span class="co">#     "bicycle_godutch",</span></span>
<span><span class="co">#     palette = "viridis",</span></span>
<span><span class="co">#     lwd = 2,</span></span>
<span><span class="co">#     breaks = c(0, 5, 10, 100)</span></span>
<span><span class="co">#   ) +</span></span>
<span><span class="co">#   tm_shape(centroids_5km) +</span></span>
<span><span class="co">#   tm_bubbles("trips") +</span></span>
<span><span class="co">#   tm_shape(school) +</span></span>
<span><span class="co">#   tm_bubbles(col = "green")</span></span>
<span></span>
<span><span class="va">quietness_breaks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">pal</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'#882255'</span>, <span class="st">'#CC6677'</span>, <span class="st">'#44AA99'</span>, <span class="st">'#117733'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">route_summaries_quiet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarise_routes.html">summarise_routes</a></span><span class="op">(</span><span class="va">routes_quiet_pct</span>,</span>
<span>  origin.col <span class="op">=</span> <span class="st">"origin"</span>,</span>
<span>  destination.col <span class="op">=</span> <span class="st">"destination"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ordered_routes_quiet</span> <span class="op">=</span> <span class="fu"><a href="../reference/cycle_bus_routes.html">cycle_bus_routes</a></span><span class="op">(</span></span>
<span>  routes <span class="op">=</span> <span class="va">route_summaries_quiet</span>,</span>
<span>  rnet <span class="op">=</span> <span class="va">rnet_quiet</span>,</span>
<span>  min_trips <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  buffer <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  attribute_trips <span class="op">=</span> <span class="st">"bicycle_godutch"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_mode.html" class="external-link">tmap_mode</a></span><span class="op">(</span><span class="st">"view"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">ordered_routes_quiet</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">route_stats_quiet</span> <span class="op">=</span> <span class="fu"><a href="../reference/calc_stats.html">calc_stats</a></span><span class="op">(</span></span>
<span>  routes <span class="op">=</span> <span class="va">route_summaries_quiet</span> ,</span>
<span>  rnet_plan <span class="op">=</span> <span class="va">rnet_quiet</span>,</span>
<span>  ordered_routes <span class="op">=</span> <span class="va">ordered_routes_quiet</span>,</span>
<span>  attribute_trips <span class="op">=</span> <span class="st">"bicycle_godutch"</span>,</span>
<span>  min_trips <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">top_routes_quiet</span> <span class="op">=</span> <span class="fu"><a href="../reference/filter_routes.html">filter_routes</a></span><span class="op">(</span></span>
<span>  routes <span class="op">=</span> <span class="va">ordered_routes_quiet</span>,</span>
<span>  buffer <span class="op">=</span> <span class="fl">300</span>,</span>
<span>  top_n <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">top_routes_quiet</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cents_quiet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_centroids.html">match_centroids</a></span><span class="op">(</span></span>
<span>  routes_cents <span class="op">=</span> <span class="va">ordered_routes_quiet</span>,</span>
<span>  top_routes <span class="op">=</span> <span class="va">top_routes_quiet</span>,</span>
<span>  route_stats <span class="op">=</span> <span class="va">route_stats_quiet</span>,</span>
<span>  origins <span class="op">=</span> <span class="va">origins</span>,</span>
<span>  max_dist_to_bikebus <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  min_dist_threshold <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  id.col <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  origin.id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  origin_route.id <span class="op">=</span> <span class="st">"origin"</span>,</span>
<span>  attribute_trips <span class="op">=</span> <span class="st">"bicycle_godutch"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">centre</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_dots</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span><span class="co"># tm_shape(cents_quiet) +</span></span>
<span><span class="co">#   tm_dots("pick") +</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">top_routes_quiet</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="st">"id"</span><span class="op">)</span></span></code></pre></div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
